import*as lpUtils from"../utils.js";import Toastify from"toastify-js";import"toastify-js/src/toastify.css";import SweetAlert from"sweetalert2";import Sortable from"sortablejs";const className={elEditQuestionWrap:".lp-edit-question-wrap",elQuestionEditMain:".lp-question-edit-main",elQuestionToggleAll:".lp-question-toggle-all",elEditListQuestions:".lp-edit-list-questions",elQuestionToggle:".lp-question-toggle",elBtnShowPopupItemsToSelect:".lp-btn-show-popup-items-to-select",elPopupItemsToSelectClone:".lp-popup-items-to-select.clone",elBtnAddQuestion:".lp-btn-add-question",elBtnRemoveQuestion:".lp-btn-remove-question",elBtnUpdateQuestionTitle:".lp-btn-update-question-title",elBtnUpdateQuestionDes:".lp-btn-update-question-des",elBtnUpdateQuestionHint:".lp-btn-update-question-hint",elBtnUpdateQuestionExplain:".lp-btn-update-question-explanation",elQuestionTitleNewInput:".lp-question-title-new-input",elQuestionTitleInput:".lp-question-title-input",elQuestionTypeLabel:".lp-question-type-label",elQuestionTypeNew:".lp-question-type-new",elAddNewQuestion:"add-new-question",elQuestionClone:".lp-question-item.clone",elAnswersConfig:".lp-answers-config",elBtnAddAnswer:".lp-btn-add-question-answer",elQuestionAnswerItemAddNew:".lp-question-answer-item-add-new",elQuestionAnswerTitleNewInput:".lp-question-answer-title-new-input",elQuestionAnswerTitleInput:".lp-question-answer-title-input",elBtnDeleteAnswer:".lp-btn-delete-question-answer",elQuestionByType:".lp-question-by-type",elInputAnswerSetTrue:".lp-input-answer-set-true",elQuestionAnswerItem:".lp-question-answer-item",elBtnUpdateQuestionAnswer:".lp-btn-update-question-answer",elBtnFibInsertBlank:".lp-btn-fib-insert-blank",elBtnFibDeleteAllBlanks:".lp-btn-fib-delete-all-blanks",elBtnFibSaveContent:".lp-btn-fib-save-content",elBtnFibClearAllContent:".lp-btn-fib-clear-all-content",elFibOptionTitleInput:".lp-question-fib-option-title-input",elFibBlankOptions:".lp-question-fib-blank-options",elFibBlankOptionItem:".lp-question-fib-blank-option-item",elFibBlankOptionItemClone:".lp-question-fib-blank-option-item.clone",elFibBlankOptionIndex:".lp-question-fib-option-index",elBtnFibOptionDelete:".lp-btn-fib-option-delete",elFibOptionMatchCaseWrap:".lp-question-fib-option-match-case-wrap",elFibOptionMatchCaseInput:".lp-question-fib-option-match-case-input",elQuestionFibOptionDetail:".lp-question-fib-option-detail",elFibOptionComparisonInput:".lp-question-fib-option-comparison-input",elAutoSaveFib:".lp-auto-save-fib",LPTarget:".lp-target",elCollapse:"lp-collapse",elSectionToggle:".lp-section-toggle",elTriggerToggle:".lp-trigger-toggle",elAutoSaveQuestion:".lp-auto-save-question",elAutoSaveAnswer:".lp-auto-save-question-answer",elQuestionFibInput:"lp-question-fib-input",elBtnQuestionCreateType:".lp-btn-question-create-type"},idUrlHandle="edit-question";let fibSelection,lpSettings={};"undefined"!=typeof lpDataAdmin?lpSettings=lpDataAdmin:"undefined"!=typeof lpData&&(lpSettings=lpData);const initTinyMCE=()=>{document.querySelectorAll(".lp-editor-tinymce").forEach(e=>{const t=e.id;reInitTinymce(t)})},reInitTinymce=e=>{window.tinymce.execCommand("mceRemoveEditor",!0,e),window.tinymce.execCommand("mceAddEditor",!0,e),eventEditorTinymce(e);const t=document.querySelector(`#wp-${e}-wrap`);t&&(t.classList.add("tmce-active"),t.classList.remove("html-active"))},eventEditorTinymce=e=>{const t=window.tinymce.get(e),s=document.getElementById(e);s.closest(`${className.elQuestionEditMain}`).dataset.questionId;t.settings.force_p_newlines=!1,t.settings.forced_root_block="",t.settings.force_br_newlines=!0,t.on("change",e=>{s.value=t.getContent(),autoUpdateQuestion(e,s)}),t.on("keyup",e=>{s.value=t.getContent(),autoUpdateQuestion(e,s)}),t.on("blur",e=>{}),t.on("focusin",e=>{}),t.on("init",()=>{t.dom.addStyle(`\n\t\t\tbody {\n\t\t\t\tline-height: 2.2;\n\t\t\t}\n\t\t\t.${className.elQuestionFibInput} {\n\t\t\t\tborder: 1px dashed rebeccapurple;\n\t\t\t\tpadding: 5px;\n\t\t\t}\n\t\t`)}),t.on("setcontent",e=>{const s=randomString(),n=t.dom.select(`.${className.elQuestionFibInput}[data-id="${s}"]`);n[0]&&n[0].focus(),t.dom.bind(n[0],"input",function(e){})}),t.on("selectionchange",s=>{if(fibSelection=t.selection,fibSelection.getNode().classList.contains(`${className.elQuestionFibInput}`)){const s=fibSelection.getNode().dataset.id,n=fibSelection.getNode().textContent.trim();if(0===n.length){const e=t.id.replace(`${className.elQuestionFibInput}-`,""),n=document.querySelector(`${className.elQuestionEditMain}[data-question-id="${e}"]`).querySelector(`${className.elFibBlankOptions}`).querySelector(`${className.elFibBlankOptionItem}[data-id="${s}"]`);n&&lpUtils.lpShowHideEl(n,0)}else{const t=document.getElementById(e).closest(`${className.elAnswersConfig}`).querySelector(`${className.elFibBlankOptionItem}[data-id="${s}"]`);if(t){const e=t.querySelector(`${className.elFibOptionTitleInput}`);e&&(e.value=n)}}}}),t.on("Undo",function(e){t.getContent();const s=t.selection.getNode();if(s.classList.contains(`${className.elQuestionFibInput}`)){const e=s.dataset.id,t=document.querySelector(`${className.elFibBlankOptionItem}[data-id="${e}"]`);t&&lpUtils.lpShowHideEl(t,1)}}),t.on("Redo",function(e){})};let timeoutAutoUpdateQuestion;const autoUpdateQuestion=(e,t,s,n)=>{const o=t.closest(`${className.elAutoSaveQuestion}`);if(!o)return;const l=o.closest(`${className.elQuestionEditMain}`).dataset.questionId;clearTimeout(timeoutAutoUpdateQuestion),timeoutAutoUpdateQuestion=setTimeout(()=>{const e={success:e=>{const{message:t,status:s}=e;if("success"!==s)throw`Error: ${t}`;showToast(t,s)},error:e=>{showToast(e,"error")},completed:()=>{}},t={action:"update_question",question_id:l,args:{id_url:idUrlHandle}};if(void 0===s){if(!(s=o.dataset.keyAutoSave)){if(!o.classList.contains("lp-editor-tinymce"))return;const e=o.id;if(!(s=e.replace(/lp-/g,"").replace(`-${l}`,"").replace(/-/g,"_")))return}n=o.value}t[s]=n,window.lpAJAXG.fetchAJAX(t,e)},700)},createQuestionType=(e,t)=>{const s=t.closest(`${className.elBtnQuestionCreateType}`);if(!s)return;const n=s.closest(`${className.elQuestionEditMain}`);if(!n)return;const o=n.dataset.questionId,l=n.querySelector(`${className.elQuestionTypeNew}`);if(!l)return;const i=l.value.trim();if(!i){const e=l.dataset.messEmptyType;return void showToast(e,"error")}const a={success:e=>{const{message:t,status:s,data:o}=e;if("success"!==s)throw`Error: ${t}`;{const{html_option_answers:e}=o;n.querySelector(`${className.elAnswersConfig}`).outerHTML=e,initTinyMCE(),sortAbleQuestionAnswer(n),showToast(t,s)}},error:e=>{showToast(e,"error")},completed:()=>{}},r={action:"update_question",question_id:o,question_type:i,args:{id_url:idUrlHandle}};window.lpAJAXG.fetchAJAX(r,a)},addQuestionAnswer=(e,t)=>{const s=t.closest(`${className.elBtnAddAnswer}`);if(!s)return;const n=s.closest(`${className.elQuestionAnswerItemAddNew}`).querySelector(`${className.elQuestionAnswerTitleNewInput}`);if(!n.value.trim()){const e=n.dataset.messEmptyTitle;return void showToast(e,"error")}const o=s.closest(`${className.elQuestionEditMain}`),l=o.querySelector(`${className.elQuestionAnswerItem}.clone`),i=l.cloneNode(!0),a=i.querySelector(`${className.elQuestionAnswerTitleInput}`);i.classList.remove("clone"),lpUtils.lpShowHideEl(i,1),lpUtils.lpSetLoadingEl(i,1),l.insertAdjacentElement("beforebegin",i);const r=n.value.trim();a.value=r,n.value="";const c={success:e=>{const{message:t,status:s,data:n}=e;if("success"!==s)throw`Error: ${t}`;{const{question_answer:e}=n;i.dataset.answerId=e.question_answer_id,lpUtils.lpSetLoadingEl(i,0);const t=getDataAnswersConfig(o);t.push(e),setDataAnswersConfig(o,t)}showToast(t,s)},error:e=>{i.remove(),showToast(e,"error")},completed:()=>{checkCanAddAnswer(null,n)}},u={action:"add_question_answer",question_id:o.dataset.questionId,answer_title:r,args:{id_url:idUrlHandle}};window.lpAJAXG.fetchAJAX(u,c)},checkCanAddAnswer=(e,t)=>{const s=t.closest(className.elQuestionAnswerTitleNewInput);if(!s)return;const n=s.closest(`${className.elQuestionAnswerItemAddNew}`);if(!n)return;const o=n.querySelector(`${className.elBtnAddAnswer}`);if(!o)return;s.value.trim()?o.classList.add("active"):o.classList.remove("active")};let timeoutAutoUpdateAnswer;const autoUpdateAnswer=(e,t)=>{const s=t.closest(`${className.elAutoSaveAnswer}`);if(!s)return;const n=s.closest(`${className.elQuestionAnswerItem}`);clearTimeout(timeoutAutoUpdateAnswer),timeoutAutoUpdateAnswer=setTimeout(()=>{const e=s.closest(`${className.elQuestionEditMain}`),t=e.dataset.questionId,o=getDataAnswersConfig(e),l=e.querySelector(`${className.elAnswersConfig}`),i=structuredClone(o),a=l.querySelectorAll(`${className.elQuestionAnswerItem}:not(.clone)`),r={};a.forEach((e,t)=>{r[e.dataset.answerId]=t+1}),o.map((t,s)=>{const n=e.querySelector(`${className.elQuestionAnswerItem}[data-answer-id="${t.question_answer_id}"]`),o=n.querySelector(`${className.elInputAnswerSetTrue}`),l=n.querySelector(`${className.elQuestionAnswerTitleInput}`);return l&&(t.title=l.value.trim()),o&&(o.checked?t.is_true="yes":t.is_true=""),r[t.question_answer_id]&&(t.order=r[t.question_answer_id]),t}),lpUtils.lpSetLoadingEl(n,1);const c={success:e=>{const{message:t,status:s}=e;if("success"!==s)throw`Error: ${t}`;showToast(t,s)},error:t=>{i.forEach(t=>{const s=e.querySelector(`${className.elQuestionAnswerItem}[data-answer-id="${t.question_answer_id}"]`).querySelector(`${className.elInputAnswerSetTrue}`);return"yes"===t.is_true&&(s.checked=!0),t}),showToast(t,"error")},completed:()=>{lpUtils.lpSetLoadingEl(n,0)}},u={action:"update_question_answers_config",question_id:t,answers:o,args:{id_url:idUrlHandle}};window.lpAJAXG.fetchAJAX(u,c)},700)},sortAbleQuestionAnswer=e=>{let t,s=0;e.querySelectorAll(`${className.elAnswersConfig}`).forEach(e=>{new Sortable(e,{handle:".drag",animation:150,onEnd:e=>{const n=e.item;s&&(clearTimeout(t),t=setTimeout(()=>{const e=n.querySelector(`${className.elAutoSaveAnswer}`);autoUpdateAnswer(0,e)},1e3))},onMove:e=>{clearTimeout(t)},onUpdate:e=>{s=1}})})},deleteQuestionAnswer=(e,t)=>{const s=t.closest(`${className.elBtnDeleteAnswer}`);if(!s)return;const n=s.closest(`${className.elQuestionAnswerItem}`);if(!n)return;const o=s.closest(`${className.elQuestionEditMain}`),l=o.dataset.questionId,i=n.dataset.answerId;l&&i&&SweetAlert.fire({title:s.dataset.title||"Are you sure?",text:s.dataset.content||"Do you want to delete this answer?",icon:"warning",showCloseButton:!0,showCancelButton:!0,cancelButtonText:lpDataAdmin.i18n.cancel,confirmButtonText:lpDataAdmin.i18n.yes,reverseButtons:!0}).then(e=>{if(e.isConfirmed){lpUtils.lpSetLoadingEl(n,1);const e={success:e=>{const{message:t,status:s}=e;if(showToast(t,s),"success"===s){const e=parseInt(n.dataset.answerId);n.remove();const t=getDataAnswersConfig(o);if(t){const s=t.filter(t=>parseInt(t.question_answer_id)!==e);setDataAnswersConfig(o,s)}}},error:e=>{showToast(e,"error")},completed:()=>{lpUtils.lpSetLoadingEl(n,0)}},t={action:"delete_question_answer",question_id:l,question_answer_id:i,args:{id_url:idUrlHandle}};window.lpAJAXG.fetchAJAX(t,e)}})},getDataAnswersConfig=e=>{const t=e.querySelector(`${className.elAnswersConfig}`);if(!t)return null;let s=t.dataset.answers||"[]";try{s=JSON.parse(s)}catch(e){s=[]}return s.meta_data||(s.meta_data={}),s},setDataAnswersConfig=(e,t)=>{const s=e.querySelector(`${className.elAnswersConfig}`);s&&(t&&"object"==typeof t||(t={}),s.dataset.answers=JSON.stringify(t))},fibInsertBlank=(e,t)=>{const s=t.closest(`${className.elBtnFibInsertBlank}`);if(!s)return;const n=s.dataset.defaultText,o=s.closest(`${className.elQuestionEditMain}`),l=o.dataset.questionId,i=s.dataset.messInserted,a=s.dataset.messRequireSelectText,r=`${className.elQuestionFibInput}-${l}`,c=randomString();let u;if(!fibSelection)return void showToast(a,"error");{const e=fibSelection.getNode();if(!e)return void showToast("Event insert blank has error, please try again","error");if(!e.closest(`body[data-id="${r}"]`))return void showToast(a,"error");if(e.classList.contains(`${className.elQuestionFibInput}`))return void showToast(i,"error");u=fibSelection.getContent(),0===u.length&&(u=n);const t=`<span class="${className.elQuestionFibInput}" data-id="${c}">${u}</span>`;fibSelection.setContent(t)}const d=getDataAnswersConfig(o);d.meta_data=d.meta_data||{},0===Object.keys(d.meta_data).length&&(d.meta_data={}),d.meta_data[c]={id:c,match_case:0,comparison:"equal",fill:u,index:1,open:!1},setDataAnswersConfig(o,d);const p=o.querySelector(`${className.elFibBlankOptions}`),m=o.querySelector(`${className.elFibBlankOptionItemClone}`),w=m.cloneNode(!0),f=p.querySelectorAll(`${className.elFibBlankOptionItem}:not(.clone)`).length,g=w.querySelector(`${className.elFibBlankOptionIndex}`),b=w.querySelector(`${className.elFibOptionTitleInput}`),A=w.querySelector(`${className.elFibOptionMatchCaseInput}`),S=w.querySelectorAll(`${className.elFibOptionComparisonInput}`);w.dataset.id=c,b.name=`${className.elFibOptionTitleInput}-${c}`,b.value=decodeHtml(u),g.textContent=f+1+".",A.name=`${className.elFibOptionMatchCaseInput}-${c}`.replace(/\./g,""),S.forEach(e=>{e.name=`${className.elFibOptionComparisonInput}-${c}`.replace(/\./g,""),"equal"===e.value&&(e.checked=!0)}),m.insertAdjacentElement("beforebegin",w),w.classList.remove("clone"),lpUtils.lpShowHideEl(w,1);const $=o.querySelector(`${className.elBtnFibSaveContent}`);lpUtils.lpSetLoadingEl(s,1),fibSaveContent(null,$,()=>{lpUtils.lpSetLoadingEl(s,0)})},fibDeleteAllBlanks=(e,t)=>{const s=t.closest(`${className.elBtnFibDeleteAllBlanks}`);if(!s)return;const n=s.closest(`${className.elQuestionEditMain}`);if(!n)return;const o=n.dataset.questionId,l=getDataAnswersConfig(n);SweetAlert.fire({title:s.dataset.title,text:s.dataset.content,icon:"warning",showCloseButton:!0,showCancelButton:!0,cancelButtonText:lpSettings.i18n.cancel,confirmButtonText:lpSettings.i18n.yes,reverseButtons:!0}).then(e=>{if(e.isConfirmed){const e=window.tinymce.get(`${className.elQuestionFibInput}-${o}`);e.dom.select(`.${className.elQuestionFibInput}`).forEach(t=>{e.dom.remove(t,!0)}),l.meta_data={},setDataAnswersConfig(n,l);n.querySelector(`${className.elFibBlankOptions}`).querySelectorAll(`${className.elFibBlankOptionItem}:not(.clone)`).forEach(e=>{e.remove()});const t=n.querySelector(`${className.elBtnFibSaveContent}`);lpUtils.lpSetLoadingEl(s,1),fibSaveContent(null,t,()=>{lpUtils.lpSetLoadingEl(s,0)})}})},fibClearContent=(e,t)=>{const s=t.closest(`${className.elBtnFibClearAllContent}`);if(!s)return;const n=s.closest(`${className.elQuestionEditMain}`);if(!n)return;const o=n.dataset.questionId,l=getDataAnswersConfig(n);SweetAlert.fire({title:s.dataset.title,text:s.dataset.content,icon:"warning",showCloseButton:!0,showCancelButton:!0,cancelButtonText:lpSettings.i18n.cancel,confirmButtonText:lpSettings.i18n.yes,reverseButtons:!0}).then(e=>{if(e.isConfirmed){window.tinymce.get(`lp-question-fib-input-${o}`).setContent(""),l.meta_data={},setDataAnswersConfig(n,l);n.querySelector(`${className.elFibBlankOptions}`).querySelectorAll(`${className.elFibBlankOptionItem}:not(.clone)`).forEach(e=>{e.remove()});const e=n.querySelector(`${className.elBtnFibSaveContent}`);lpUtils.lpSetLoadingEl(s,1),fibSaveContent(null,e,()=>{lpUtils.lpSetLoadingEl(s,0)})}})},fibDeleteBlank=(e,t)=>{const s=t.closest(`${className.elBtnFibOptionDelete}`);if(!s)return;const n=s.closest(`${className.elQuestionEditMain}`);if(!n)return;const o=n.dataset.questionId,l=(n.querySelector(`${className.elAnswersConfig}`),getDataAnswersConfig(n)),i=s.closest(`${className.elFibBlankOptionItem}`),a=i.dataset.id;SweetAlert.fire({title:s.dataset.title,text:s.dataset.content,icon:"warning",showCloseButton:!0,showCancelButton:!0,cancelButtonText:lpSettings.i18n.cancel,confirmButtonText:lpSettings.i18n.yes,reverseButtons:!0}).then(e=>{if(e.isConfirmed){const e=window.tinymce.get(`${className.elQuestionFibInput}-${o}`),t=e.dom.select(`.${className.elQuestionFibInput}[data-id="${a}"]`);t[0]&&e.dom.remove(t[0],!0),i.remove(),l.meta_data=l.meta_data||{},l.meta_data[a]&&delete l.meta_data[a],setDataAnswersConfig(n,l);const s=n.querySelector(`${className.elBtnFibSaveContent}`);lpUtils.lpSetLoadingEl(i,1),fibSaveContent(null,s,()=>{})}})};let timeoutAutoUpdateFib;const fibOptionTitleInputChange=(e,t)=>{const s=t.closest(`${className.elFibOptionTitleInput}`);if(!s)return;const n=s.closest(`${className.elFibBlankOptionItem}`);if(!n)return;const o=s.closest(`${className.elQuestionEditMain}`);if(!o)return;const l=s.value.trim(),i=n.dataset.id,a=o.dataset.questionId,r=window.tinymce.get(`lp-question-fib-input-${a}`).dom.select(`.lp-question-fib-input[data-id="${i}"]`);r[0]&&(r[0].textContent=l),clearTimeout(timeoutAutoUpdateFib),timeoutAutoUpdateFib=setTimeout(()=>{const e=o.querySelector(`${className.elBtnFibSaveContent}`);fibSaveContent(null,e)},700)},fibSaveContent=(e,t,s)=>{const n=t.closest(`${className.elBtnFibSaveContent}`);if(!n)return;const o=n.closest(`${className.elQuestionEditMain}`),l=o.dataset.questionId,i=getDataAnswersConfig(o);if(!i)return;const a=window.tinymce.get(`${className.elQuestionFibInput}-${l}`);i.title=a.getContent();const r=o.querySelectorAll(`${className.elFibBlankOptionItem}:not(.clone)`);r&&r.forEach(e=>{const t=e.dataset.id,s=e.querySelector(`${className.elFibOptionMatchCaseInput}`),n=e.querySelector(`${className.elFibOptionComparisonInput}:checked`);i.meta_data[t].match_case=s.checked?1:0,i.meta_data[t].comparison=n.value}),s||lpUtils.lpSetLoadingEl(n,1);const c={success:e=>{const{message:t,status:s}=e;if("success"!==s)throw`Error: ${t}`;setDataAnswersConfig(o,i),showToast(t,s)},error:e=>{showToast(e,"error")},completed:()=>{s&&"function"==typeof s?s():lpUtils.lpSetLoadingEl(n,0)}},u={action:"update_question_answers_config",question_id:l,answers:i,args:{id_url:idUrlHandle}};window.lpAJAXG.fetchAJAX(u,c)},fibShowHideMatchCaseOption=(e,t)=>{const s=t.closest(`${className.elFibOptionMatchCaseInput}`);if(!s)return;const n=s.closest(`${className.elQuestionFibOptionDetail}`),o=n.querySelector(`${className.elFibOptionMatchCaseWrap}`);n&&o&&(s.checked?lpUtils.lpShowHideEl(o,1):lpUtils.lpShowHideEl(o,0))},toggleSection=(e,t,s="",n=[])=>{if(s||(s=className.elTriggerToggle),n&&n.length>0)for(const e of n)if(t.closest(e))return;const o=t.closest(s);if(!o)return;const l=o.closest(`${className.elSectionToggle}`);l&&l.classList.toggle(`${className.elCollapse}`)},randomString=(e=10)=>{const t="abcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let n=0;n<e;n++)s+=t.charAt(Math.floor(36*Math.random()));return s},decodeHtml=e=>{const t=document.createElement("textarea");return t.innerHTML=e,t.value},argsToastify={text:"",gravity:lpSettings.toast.gravity,position:lpSettings.toast.position,className:`${lpSettings.toast.classPrefix}`,close:1==lpSettings.toast.close,stopOnFocus:1==lpSettings.toast.stopOnFocus,duration:lpSettings.toast.duration},showToast=(e,t="success")=>{new Toastify({...argsToastify,text:e,className:`${lpSettings.toast.classPrefix} ${t}`}).showToast()},events=()=>{document.addEventListener("click",e=>{const t=e.target;if(deleteQuestionAnswer(0,t),addQuestionAnswer(0,t),createQuestionType(0,t),fibInsertBlank(0,t),fibDeleteAllBlanks(0,t),fibClearContent(0,t),fibDeleteBlank(0,t),fibSaveContent(e,t),fibShowHideMatchCaseOption(0,t),t.closest(`${className.elFibOptionMatchCaseInput}`)||t.closest(`${className.elFibOptionComparisonInput}`)){const s=t.closest(`${className.elQuestionEditMain}`).querySelector(`${className.elBtnFibSaveContent}`);fibSaveContent(e,s)}lpUtils.toggleCollapse(e,t)}),document.addEventListener("change",e=>{const t=e.target;autoUpdateQuestion(e,t),autoUpdateAnswer(0,t)}),document.addEventListener("keyup",e=>{const t=e.target;autoUpdateAnswer(0,t),fibOptionTitleInputChange(0,t),checkCanAddAnswer(e,t)}),document.addEventListener("keydown",e=>{const t=e.target;if("Enter"===e.key)if(t.closest(`${className.elQuestionAnswerTitleNewInput}`)){const s=t.closest(`${className.elQuestionAnswerItemAddNew}`).querySelector(`${className.elBtnAddAnswer}`);addQuestionAnswer(0,s),e.preventDefault()}else(t.closest(`${className.elQuestionAnswerTitleInput}`)||t.closest(".lp-question-point-input")||t.closest(`${className.elFibOptionTitleInput}`))&&e.preventDefault()})};lpUtils.lpOnElementReady(`${className.elEditQuestionWrap}`,e=>{const t=className.elQuestionEditMain.replace(".","");e.classList.contains(t)&&(events(),initTinyMCE(),sortAbleQuestionAnswer(e))});export{events,initTinyMCE,showToast,sortAbleQuestionAnswer};